<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="æ¢ç©¶Androidå¼€å‘æŠ€æœ¯">
    <meta name="author" content="cfanr">
    
    <title>
        
            Android NDK å¼€å‘ï¼šå®æˆ˜æ¡ˆä¾‹ |
        
        cfanr&#39;s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.png">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"navyifanr.github.io","root":"/","language":"en"};
    KEEP.theme_config = {"toc":{"enable":false,"number":false,"expand_all":false,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.png","favicon":"/images/logo.png","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":false,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving."},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":false}}},"local_search":{"enable":false,"preload":false},"code_copy":{"enable":false,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                cfanr&#39;s Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">Android NDK å¼€å‘ï¼šå®æˆ˜æ¡ˆä¾‹</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.png">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">cfanr</span>
                        
                            <span class="author-label">Lv4</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2017-08-19 10:06:21</span>
        <span class="mobile">2017-08-19 10:06</span>
    </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Android-NDK/">Android NDK</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h3 id="0-å‰è¨€"><a href="#0-å‰è¨€" class="headerlink" title="0. å‰è¨€"></a>0. å‰è¨€</h3><p>å¦‚æœåªå­¦ç†è®ºï¼Œä¸åšå®è·µï¼Œä¸è¸©è¸©å‘ï¼Œä¸€èˆ¬å¾ˆéš¾å‘ç°çœŸæ­£å®è·µé¡¹ç›®ä¸­çš„é—®é¢˜çš„ï¼Œä¹Ÿæ¯”è¾ƒéš¾ä»¥åŠ æ·±å¯¹æŠ€æœ¯çš„ç†è§£ã€‚æ‰€ä»¥å»¶ç»­ä¸Šç¯‡ JNI çš„å®æˆ˜<a class="link"   target="_blank" rel="noopener" href="http://cfanr.cn/2017/08/05/Android-NDK-dev-JNI-s-practice/" >Android NDKå¼€å‘ï¼šJNIå®æˆ˜ç¯‡ <i class="fas fa-external-link-alt"></i></a>ï¼Œè¿™ç¯‡ä¸»è¦æ˜¯ä¸€äº› NDK å°é¡¹ç›®çš„ç»ƒä¹ ï¼Œç”±äºè¿™äº›é¡¹ç›®ç½‘ä¸Šéƒ½æœ‰ demoä»‹ç»ï¼Œè¿™é‡Œä¸ä¼šå…·ä½“ä¸€æ­¥æ­¥ä»‹ç»å¦‚ä½•æ“ä½œï¼Œåªè®°å½•ä¸€äº›ä¸ªäººéœ€è¦æ³¨æ„çš„åœ°æ–¹æˆ–ä¸€äº›ä¸»è¦æ­¥éª¤ï¼Œè¯¦ç»†çš„ä»‹ç»æˆ–ä»£ç å¯ä»¥ç‚¹å‡»é‡Œé¢çš„é“¾æ¥æŸ¥çœ‹ã€‚</p>
<h3 id="1-æ–‡ä»¶åŠ è§£å¯†å’Œåˆ†å‰²åˆå¹¶"><a href="#1-æ–‡ä»¶åŠ è§£å¯†å’Œåˆ†å‰²åˆå¹¶" class="headerlink" title="1. æ–‡ä»¶åŠ è§£å¯†å’Œåˆ†å‰²åˆå¹¶"></a>1. æ–‡ä»¶åŠ è§£å¯†å’Œåˆ†å‰²åˆå¹¶</h3><h4 id="1-1-ç®€ä»‹"><a href="#1-1-ç®€ä»‹" class="headerlink" title="1.1 ç®€ä»‹"></a>1.1 ç®€ä»‹</h4><p>æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯äºŒè¿›åˆ¶å­˜å‚¨çš„ï¼Œæ— è®ºæ˜¯æ–‡æœ¬ï¼Œå›¾ç‰‡è¿˜æ˜¯è§†é¢‘æ–‡ä»¶éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶å­˜å‚¨åœ¨ç£ç›˜ä¸­ã€‚æ‰€ä»¥å¯ä»¥é€šè¿‡å¯¹æ–‡ä»¶è¿›è¡ŒäºŒè¿›åˆ¶è¿ç®—è¿›è¡ŒåŠ è§£å¯†ã€‚ä¸‹é¢ç”¨åˆ°çš„æ˜¯æ¯”è¾ƒç®€å•çš„<code>^</code>å¼‚æˆ–è¿ç®—æ¥å¯¹æ–‡ä»¶åŠ è§£å¯†ï¼ˆç®—æ˜¯ä¸€ç§å¯¹ç§°åŠ å¯†ç®—æ³•ï¼‰<br>é™„ï¼šåŠ è§£å¯†ç®—æ³•æ‰©å±•ï¼š<a class="link"   target="_blank" rel="noopener" href="https://yeasy.gitbooks.io/blockchain_guide/content/crypto/algorithm.html" >åŠ è§£å¯†ç®—æ³• Â· åŒºå—é“¾æŠ€æœ¯æŒ‡å—<i class="fas fa-external-link-alt"></i></a></p>
<p>ä¸€èˆ¬åœ¨å¤§æ–‡ä»¶ä¼ è¾“æ—¶ï¼Œå¦‚éŸ³è§†é¢‘æ–‡ä»¶ï¼Œä¼šå°†æ–‡ä»¶åˆ†å‰²åå†ä¼ è¾“ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚å½“éœ€è¦ä½¿ç”¨æ—¶ï¼Œå†å°†åˆ†å‰²åçš„æ–‡ä»¶åˆå¹¶å³å¯ã€‚</p>
<p>è€Œæ–‡ä»¶åŠ è§£å¯†è®¾è®¡åˆ°å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨ NDK å¢åŠ åç¼–è¯‘çš„éš¾åº¦ã€‚å¦å¤–æ–‡ä»¶çš„åˆ†å‰²åˆå¹¶éƒ½æ¯”è¾ƒè€—æ€§èƒ½ï¼Œå¯ä»¥æ”¾åˆ° NDK å¤„ç†æé«˜æ•ˆç‡ã€‚</p>
<span id="more"></span>

<p>ä»¥ä¸‹ç»ƒä¹ å‚è€ƒï¼š<a class="link"   target="_blank" rel="noopener" href="http://www.jianshu.com/p/4333d7ddf615" >NDKå¼€å‘åŸºç¡€â‘¡æ–‡ä»¶åŠ å¯†è§£å¯†ä¸åˆ†å‰²åˆå¹¶ - ç®€ä¹¦<i class="fas fa-external-link-alt"></i></a></p>
<p>æ•ˆæœå›¾å¦‚å›¾ï¼Œè¿›å…¥ç•Œé¢ä¼šæ‹·è´ä¸¤å¼  assets çš„å›¾ç‰‡<code>cats.jpg</code>å’Œ<code>image.jpg</code>åˆ°æœ¬åœ° <code>sdcard/NdkSample</code> ç›®å½•ä¸‹ä½œä¸ºæµ‹è¯•ã€‚åŠ å¯†åçš„å›¾ç‰‡ <code>cats_encypt.jpg</code>æ˜¯æ— æ³•ç›´æ¥æŸ¥çœ‹çš„ï¼Œåˆæˆçš„å›¾ç‰‡æ˜¯ <code>image.jpeg</code><br><img src="https://i.loli.net/2019/06/10/5cfe7344b2e7f46208.png" alt="æ•ˆæœå›¾"></p>
<h4 id="1-2-æ–‡ä»¶åŠ è§£å¯†"><a href="#1-2-æ–‡ä»¶åŠ è§£å¯†" class="headerlink" title="1.2 æ–‡ä»¶åŠ è§£å¯†"></a>1.2 æ–‡ä»¶åŠ è§£å¯†</h4><p>Java ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileUtils</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FILE_PATH_PREFIX</span> <span class="operator">=</span> Environment.getExternalStorageDirectory() + File.separator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FOLDER_NAME</span> <span class="operator">=</span> <span class="string">&quot;NdkSample&quot;</span> + File.separator;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FILE_PATH</span> <span class="operator">=</span> FILE_PATH_PREFIX + FOLDER_NAME;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">fileEncrypt</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">normalFilePath</span> <span class="operator">=</span> FILE_PATH + <span class="string">&quot;cats.jpg&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">encryptFilePath</span> <span class="operator">=</span> FILE_PATH + <span class="string">&quot;cats_encrypt.jpg&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> fileEncrypt(normalFilePath, encryptFilePath);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">fileDecode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">encryptFilePath</span> <span class="operator">=</span> FILE_PATH + <span class="string">&quot;cats_encrypt.jpg&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">decodeFilePath</span> <span class="operator">=</span> FILE_PATH + <span class="string">&quot;cats_decode.jpg&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> fileDecode(encryptFilePath, decodeFilePath);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">fileEncrypt</span><span class="params">(String normalFilePath, String encryptFilePath)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">fileDecode</span><span class="params">(String encryptFilePath, String decodeFilePath)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JNI åŠ å¯†ä»£ç å®ç°ï¼Œæ³¨æ„åŠ æ–‡ä»¶è¯»å†™æƒé™</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">char</span> *PASSWORD = <span class="string">&quot;pw&quot;</span>;</span><br><span class="line"><span class="type">long</span> <span class="title function_">getFileSize</span><span class="params">(<span class="type">char</span>* filePath)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span></span><br><span class="line">JNIEXPORT jboolean JNICALL</span><br><span class="line"><span class="title function_">Java_cn_cfanr_ndksample_utils_FileUtils_fileEncrypt</span><span class="params">(JNIEnv *env, jclass type, jstring normalFilePath_,</span></span><br><span class="line"><span class="params">                                                    jstring encryptFilePath_)</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *normalFilePath = env-&gt;GetStringUTFChars(normalFilePath_, <span class="number">0</span>);</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *encryptFilePath = env-&gt;GetStringUTFChars(encryptFilePath_, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> passwordLen = <span class="built_in">strlen</span>(PASSWORD);</span><br><span class="line"></span><br><span class="line">    LOGE(<span class="string">&quot;è¦åŠ å¯†çš„æ–‡ä»¶çš„è·¯å¾„ = %s , åŠ å¯†åçš„æ–‡ä»¶çš„è·¯å¾„ = %s&quot;</span>, normalFilePath, encryptFilePath);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¯»æ–‡ä»¶æŒ‡é’ˆ</span></span><br><span class="line">    FILE *frp = fopen(normalFilePath, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    <span class="comment">// å†™æ–‡ä»¶æŒ‡é’ˆ</span></span><br><span class="line">    FILE *fwp = fopen(encryptFilePath, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (frp == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        LOGE(<span class="string">&quot;æ–‡ä»¶ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> JNI_FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (fwp == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        LOGE(<span class="string">&quot;æ²¡æœ‰å†™æƒé™&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> JNI_FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾¹è¯»è¾¹å†™è¾¹åŠ å¯†</span></span><br><span class="line">    <span class="type">int</span> buffer;</span><br><span class="line">    <span class="type">int</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ((buffer = fgetc(frp)) != EOF) &#123;</span><br><span class="line">        <span class="comment">// write</span></span><br><span class="line">        fputc(buffer ^ *(PASSWORD + (index % passwordLen)), fwp);  <span class="comment">//å¼‚æˆ–çš„æ–¹å¼åŠ å¯†</span></span><br><span class="line">        index++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å…³é—­æ–‡ä»¶æµ</span></span><br><span class="line">    fclose(fwp);</span><br><span class="line">    fclose(frp);</span><br><span class="line"></span><br><span class="line">    LOGE(<span class="string">&quot;æ–‡ä»¶åŠ å¯†æˆåŠŸ&quot;</span>);</span><br><span class="line"></span><br><span class="line">    env-&gt;ReleaseStringUTFChars(normalFilePath_, normalFilePath);</span><br><span class="line">    env-&gt;ReleaseStringUTFChars(encryptFilePath_, encryptFilePath);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> JNI_TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è§£å¯†ä»£ç ç±»ä¼¼ã€‚</p>
<h4 id="1-3-æ–‡ä»¶åˆ†å‰²åˆå¹¶"><a href="#1-3-æ–‡ä»¶åˆ†å‰²åˆå¹¶" class="headerlink" title="1.3 æ–‡ä»¶åˆ†å‰²åˆå¹¶"></a>1.3 æ–‡ä»¶åˆ†å‰²åˆå¹¶</h4><p>Java ä»£ç å®ç°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">fileSplit</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">splitFilePath</span> <span class="operator">=</span> FILE_PATH + <span class="string">&quot;image.jpg&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> <span class="string">&quot;.b&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> fileSplit(splitFilePath, suffix, <span class="number">4</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡ä»¶åˆå¹¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">fileMerge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">splitFilePath</span> <span class="operator">=</span> FILE_PATH + <span class="string">&quot;image.jpg&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">splitSuffix</span> <span class="operator">=</span> <span class="string">&quot;.b&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">mergeSuffix</span> <span class="operator">=</span> <span class="string">&quot;.jpeg&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> fileMerge(splitFilePath, splitSuffix, mergeSuffix, <span class="number">4</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡ä»¶åˆ†å‰²</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> splitFilePath è¦åˆ†å‰²æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> suffix        åˆ†å‰²æ–‡ä»¶çš„æ‰©å±•å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileNum       åˆ†å‰²æ–‡ä»¶çš„æ•°é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">fileSplit</span><span class="params">(String splitFilePath, String suffix, <span class="type">int</span> fileNum)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡ä»¶åˆå¹¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> splitFilePath åˆ†å‰²æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> splitSuffix   åˆ†å‰²æ–‡ä»¶çš„æ‰©å±•å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mergeSuffix   åˆå¹¶æ–‡ä»¶çš„æ‰©å±•å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileNum       åˆ†å‰²æ–‡ä»¶çš„æ•°é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">fileMerge</span><span class="params">(String splitFilePath, String splitSuffix, String mergeSuffix, <span class="type">int</span> fileNum)</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œæ–‡ä»¶çš„åˆ†å‰²åˆå¹¶éœ€è¦è®¾ç½®æ–‡ä»¶æ‰©å±•åååˆ†å‰²æ–‡ä»¶æ•°é‡ã€‚åˆ†å‰²æ—¶ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼Œ<br>1ï¼‰èƒ½æ•´é™¤çš„ï¼Œç›´æ¥å¹³å‡åˆ†ï¼›<br>2ï¼‰ä¸èƒ½æ•´é™¤çš„ï¼ŒfileSize % ( n -1)ï¼Œå‰ n -1 ä¸ªå¹³å‡åˆ†ï¼Œå‰©ä½™çš„ç•™ç»™æœ€åä¸€ä¸ªï¼›<br><strong>åˆå¹¶æ—¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¿…é¡»æŒ‰ç…§åˆ†å‰²çš„é¡ºåºåˆå¹¶</strong></p>
<p>å…¶ä½™ JNI å®ç°ä»£ç ç•¥ï¼Œå¯ä»¥åˆ° GitHub æŸ¥çœ‹å…·ä½“æºç ï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/navyifanr/NdkSample/blob/master/app/src/main/cpp/native_file_handler.cpp" >NdkSample&#x2F;native_file_handler.cpp <i class="fas fa-external-link-alt"></i></a></p>
<h3 id="2-Android-å¢é‡æ›´æ–°"><a href="#2-Android-å¢é‡æ›´æ–°" class="headerlink" title="2. Android å¢é‡æ›´æ–°"></a>2. Android å¢é‡æ›´æ–°</h3><h4 id="2-1-ç®€ä»‹"><a href="#2-1-ç®€ä»‹" class="headerlink" title="2.1 ç®€ä»‹"></a>2.1 ç®€ä»‹</h4><p>æ‰€è°“å¢é‡æ›´æ–°ï¼Œæ˜¯<strong>æœåŠ¡å™¨å°†æ–°æ—§ç‰ˆæœ¬çš„ apk åšå·®åˆ†å¤„ç†ï¼Œç”Ÿæˆä¸€ä¸ªå·®åˆ†åŒ… patchï¼Œä¸‹å‘åˆ°å®¢æˆ·ç«¯ï¼›å®¢æˆ·ç«¯å†ç”¨ patch åŒ…å’Œæœ¬åœ°çš„ apk åˆå¹¶æˆæ–°çš„ apkï¼Œå†å®‰è£…</strong>ã€‚å¾ˆæ˜¾ç„¶ï¼Œè¿™æ ·åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥å‡å°‘æ›´æ–° apk æ—¶æ¶ˆè€—çš„æµé‡ã€‚ç›®å‰åœ¨å¾ˆå¤šåº”ç”¨å¸‚åœºä¹Ÿæœ‰ç”¨åˆ°è¿™ç§æŠ€æœ¯ã€‚<strong>å¢é‡æ›´æ–°æŠ€æœ¯ä¸»è¦è§£å†³æ˜¯å®‰è£…åŒ…æ–‡ä»¶è¿‡å¤§çš„é—®é¢˜ã€‚</strong></p>
<h4 id="2-2-ä¼˜ç¼ºç‚¹"><a href="#2-2-ä¼˜ç¼ºç‚¹" class="headerlink" title="2.2 ä¼˜ç¼ºç‚¹"></a>2.2 ä¼˜ç¼ºç‚¹</h4><p>ä¼˜ç‚¹ï¼šèŠ‚çœæµé‡ï¼Œä¸‹è½½ apk æ—¶ï¼Œåªéœ€è¦ä¸‹è½½å·®åˆ†åŒ…ï¼Œä¸ç”¨ä¸‹è½½å®Œæ•´åŒ…ï¼›<br>ç¼ºç‚¹ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½éœ€è¦åŠ å…¥ç›¸å…³çš„æ”¯æŒã€‚æ¯æ¬¡æ–°ç‰ˆæœ¬å‘å¸ƒï¼ŒæœåŠ¡å™¨éœ€è¦æ ¹æ®æ–°ç‰ˆæœ¬å¯¹ä»¥å‰æ‰€æœ‰è€ç‰ˆæœ¬ç”Ÿæˆå¯¹åº”çš„å·®åˆ†åŒ…ï¼Œè€Œä¸”è¿˜è¦ç»´æŠ¤ä¸åŒæ¸ é“çš„åŒ…ï¼›å¦å¤–å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œä¸Šä¼ å½“å‰ç‰ˆæœ¬å·ï¼ŒæœåŠ¡å™¨è¿”å›å¯¹åº”çš„å·®åˆ†åŒ…å’Œæ–°ç‰ˆæœ¬ apkçš„ md5 å€¼ï¼Œä½œä¸ºåˆå¹¶æ–° apk åçš„æ ¡éªŒï¼›æ‰€ä»¥æ•´ä½“æµç¨‹ä¼šæœ‰ç‚¹ç¹çï¼›</li>
<li>åˆæˆå·®åˆ†åŒ…ä¼šæœ‰ç‚¹è€—æ—¶ï¼ˆæœ€å¥½ç”¨å•ç‹¬çº¿ç¨‹å¤„ç†ï¼‰å’Œè€—å†…å­˜çš„ï¼Œå†…å­˜ä¸è¶³çš„æ‰‹æœºæˆ–æœ¬åœ° apk æŸåçš„ apk æ— æ³•è¿›è¡Œå¢é‡æ›´æ–°ï¼›å¦å¤– apk åŒ…ä¹‹é—´å·®å¼‚æ¯”è¾ƒå°ï¼ˆ2m ä»¥ä¸‹ï¼‰æ—¶ï¼Œç”Ÿæˆçš„å·®åˆ†åŒ…ä»ç„¶æœ‰å‡ ç™¾ kï¼›</li>
</ul>
<h4 id="2-3-å·®åˆ†åŒ…çš„ç”Ÿæˆä¸åˆå¹¶"><a href="#2-3-å·®åˆ†åŒ…çš„ç”Ÿæˆä¸åˆå¹¶" class="headerlink" title="2.3 å·®åˆ†åŒ…çš„ç”Ÿæˆä¸åˆå¹¶"></a>2.3 å·®åˆ†åŒ…çš„ç”Ÿæˆä¸åˆå¹¶</h4><p>éœ€è¦ç”¨å·¥å…·å¯¹æ–‡ä»¶è¿›è¡Œ diff å’Œ patch å¤„ç†ï¼Œä¸€èˆ¬å¯ä»¥é€šè¿‡ <a class="link"   target="_blank" rel="noopener" href="http://www.daemonology.net/bsdiff/" >bsdiff<i class="fas fa-external-link-alt"></i></a>å®ç°</p>
<p>å…·ä½“ä½¿ç”¨å¯ä»¥å‚è€ƒ Hongyang çš„æ–‡ç«  <a class="link"   target="_blank" rel="noopener" href="http://blog.csdn.net/lmj623565791/article/details/52761658#t1" >Android å¢é‡æ›´æ–°å®Œå…¨è§£æ  æ˜¯å¢é‡ä¸æ˜¯çƒ­ä¿®å¤ - Hongyang<i class="fas fa-external-link-alt"></i></a>ï¼Œåœ¨è¿™é‡Œå°±ä¸å•°å—¦äº†</p>
<p>æ³¨æ„ï¼Œåœ¨æ‰§è¡Œ make å‘½ä»¤ï¼Œå¯èƒ½æŠ¥ä»¥ä¸‹é”™è¯¯ï¼Œï¼ˆä»¥ä¸‹ç¯å¢ƒéƒ½æ˜¯åœ¨ Mac ä¸Šï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bspatch.c:39:21: error: unknown type name &#x27;u_char&#x27;; did you mean &#x27;char&#x27;?</span><br><span class="line">static off_t offtin(u_char *buf)</span><br><span class="line">                    ^~~~~~</span><br><span class="line">                    char</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥é€šè¿‡åœ¨<code>bspatch.c</code> æ–‡ä»¶åŠ ä¸Š<code>#include &lt;sys/types.h&gt;</code>å¤´æ–‡ä»¶ï¼ˆHongyang æ²¡è¯´æ˜æ¸…æ¥šï¼‰ï¼Œå‚è€ƒï¼š<a class="link"   target="_blank" rel="noopener" href="http://www.cnblogs.com/lping/p/5833090.html" >ç¼–è¯‘å’Œä½¿ç”¨bsdiff - æœ¨å¤´å¹³ - åšå®¢å›­<i class="fas fa-external-link-alt"></i></a></p>
<p>ä¸»è¦æŒæ¡å‡ ä¸ªå‘½ä»¤ï¼š</p>
<ul>
<li>æ‰§è¡Œ <code>make</code> å‘½ä»¤ï¼Œä½¿ makefile  ç”Ÿæˆ bsdiff å’Œ bspatch å¯æ‰§è¡Œæ–‡ä»¶ï¼›</li>
<li>æ‰§è¡Œ <code>./bsdiff old.apk new.apk update.patch</code>ï¼Œç”Ÿæˆå·®åˆ†åŒ…ï¼›</li>
<li>æ‰§è¡Œ <code>./bspatch old.apk new2.apk update.patch</code>ï¼Œåˆæˆæ–° apkï¼›</li>
<li>æ‰§è¡Œ <code>md5 xxx.apk</code> æŸ¥çœ‹ apk çš„ md5 å€¼ï¼›</li>
</ul>
<h4 id="2-4-æœåŠ¡ç«¯æ“ä½œ"><a href="#2-4-æœåŠ¡ç«¯æ“ä½œ" class="headerlink" title="2.4 æœåŠ¡ç«¯æ“ä½œ"></a>2.4 æœåŠ¡ç«¯æ“ä½œ</h4><p>æœåŠ¡ç«¯éœ€è¦è¿”å›ä¸€ä¸ªæ–‡ä»¶å’Œæ–°ç‰ˆæœ¬ apk md5å€¼ç»™å®¢æˆ·ç«¯ã€‚</p>
<ul>
<li>ç”¨ 2.3 ç”Ÿæˆçš„ bsdiff å¯æ‰§è¡Œæ–‡ä»¶ç”Ÿæˆæ–°ç‰ˆæœ¬ apk å’Œè€ç‰ˆæœ¬çš„ apk çš„å·®åˆ†åŒ… update.patchï¼›ï¼ˆå¯ä»¥ç¼–å†™ä¸ªè„šæœ¬å¤„ç†ï¼‰</li>
<li>ä½¿ç”¨ md5 å‘½ä»¤æŸ¥çœ‹æ–° apk çš„ md5ï¼Œå¹¶ä¿å­˜ï¼Œä¹‹åéœ€è¦è¿”å›ç»™å®¢æˆ·ç«¯ï¼›</li>
</ul>
<h4 id="2-5-å®¢æˆ·ç«¯æ“ä½œ"><a href="#2-5-å®¢æˆ·ç«¯æ“ä½œ" class="headerlink" title="2.5 å®¢æˆ·ç«¯æ“ä½œ"></a>2.5 å®¢æˆ·ç«¯æ“ä½œ</h4><p>ä¸»è¦å®ç°æ˜¯å¦‚ä½•åˆ¶é€  bspatch çš„ so æ–‡ä»¶ï¼Œç”±äºç½‘ä¸Šè¯¦ç»†çš„æ­¥éª¤éƒ½æ¯”è¾ƒå®Œå–„äº†ï¼Œè¿™é‡Œä¹Ÿä¸å•°å—¦äº†ï¼Œåªç®€å•è¯´ä¸‹éœ€è¦æ³¨æ„çš„é—®é¢˜ã€‚</p>
<p>ç”±äºæŒ‰ç…§ AS çš„é»˜è®¤çš„ CMake å»º NDK çš„æ–¹å¼ï¼ŒC&#x2F;C++ çš„æ–‡ä»¶æ˜¯åœ¨ cpp ç›®å½•çš„ï¼ŒHongyang çš„æ˜¯åœ¨ jni ç›®å½•ï¼Œä¸¤è€…é…ç½®æ–¹å¼ä¸å¤ªä¸€æ ·ï¼Œå¦‚æœåŒæ—¶ä½¿ç”¨ï¼Œåªä¼šç¼–è¯‘ CMake çš„é…ç½®ï¼Œæ‰€ä»¥éœ€è¦å°† <code>bspatch.c</code>æ”¾åˆ° cpp ç›®å½•ï¼ŒåŒæ—¶è¿˜éœ€è¦ä¸‹è½½ <a class="link"   target="_blank" rel="noopener" href="http://www.bzip.org/downloads.html" >bzip<i class="fas fa-external-link-alt"></i></a> æºç </p>
<p>è¯¦ç»†æ­¥éª¤å¯ä»¥å‚è€ƒï¼Œ<a class="link"   target="_blank" rel="noopener" href="http://blog.csdn.net/myatlantis/article/details/52874227#t1" >Androidå¢é‡æ›´æ–°ä¸CMakeæ„å»ºå·¥å…· - äºšç‰¹å…°è’‚æ–¯ - CSDNåšå®¢<i class="fas fa-external-link-alt"></i></a></p>
<p>PSï¼šè¿™é‡Œçš„ CMakeLists.txt æ˜¯æ”¾åœ¨ cpp ç›®å½•ä¸‹ï¼Œç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>ç”±äº CMakeLists.txt ç›®å½•æ”¹å˜äº†ï¼Œå¿…é¡»ä¿®æ”¹ C&#x2F;C++ æºæ–‡ä»¶çš„è·¯å¾„ï¼Œå»æ‰</strong> <code>src/main/cpp</code>ï¼ŒåŒæ—¶ä¹Ÿè¦ä¿®æ”¹<code>build.gradle</code>çš„ cmake æ–‡ä»¶çš„è·¯å¾„ï¼Œä¸ç„¶ä¼šç¼–è¯‘å¤±è´¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># Sets the minimum version of CMake required to build the native library.</span><br><span class="line">cmake_minimum_required(VERSION 3.4.1)</span><br><span class="line"></span><br><span class="line">#æ”¯æŒ-std=gnu++11</span><br><span class="line">set(CMAKE_VERBOSE_MAKEFILE on)</span><br><span class="line">set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=gnu++11 -Wall -DGLM_FORCE_SIZE_T_LENGTH&quot;)</span><br><span class="line">set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -DGLM_FORCE_RADIANS&quot;)</span><br><span class="line"></span><br><span class="line">#è®¾ç½®ç”Ÿæˆçš„soåŠ¨æ€åº“æœ€åè¾“å‡ºçš„è·¯å¾„</span><br><span class="line">set(CMAKE_LIBRARY_OUTPUT_DIRECTORY $&#123;PROJECT_SOURCE_DIR&#125;/../jniLibs/$&#123;ANDROID_ABI&#125;)</span><br><span class="line"></span><br><span class="line">#æ·»åŠ bzip2ç›®å½•ï¼Œä¸ºæ„å»ºæ·»åŠ ä¸€ä¸ªå­è·¯å¾„</span><br><span class="line">set(bzip2_src_DIR $&#123;CMAKE_SOURCE_DIR&#125;)</span><br><span class="line">add_subdirectory($&#123;bzip2_src_DIR&#125;/bzip2)</span><br><span class="line"></span><br><span class="line">add_library( native-lib</span><br><span class="line">             SHARED</span><br><span class="line">             # Provides a relative path to your source file(s). æ³¨æ„ï¼ŒCMakeLists.txt åœ¨ cpp ç›®å½•ä¸‹ï¼Œæ­¤å¤„ä¸éœ€è¦åŠ è·¯å¾„å‰ç¼€ src/main/cpp</span><br><span class="line">             native_file_handler.cpp</span><br><span class="line">             bspatch.c</span><br><span class="line">             )</span><br><span class="line"></span><br><span class="line">find_library(log-lib log )</span><br><span class="line"></span><br><span class="line">target_link_libraries(native-lib $&#123;log-lib&#125; )</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>build.gradle æ–‡ä»¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">externalNativeBuild &#123;</span><br><span class="line">     cmake &#123;</span><br><span class="line">         path <span class="string">&quot;src/main/cpp/CMakeLists.txt&quot;</span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>å¦å¤–ï¼Œä¿®æ”¹çš„ <code>bspatch.c</code> æ–‡ä»¶å¢åŠ çš„ JNI ä»£ç ä¸­ï¼Œ<strong>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ so åº“çš„åå­—ï¼Œæ³¨æ„ä¸€å®šè¦ä¿æŒä¸€è‡´</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//â€¦â€¦</span></span><br><span class="line">JNIEXPORT jint JNICALL <span class="title function_">Java_cn_cfanr_ndksample_utils_BsPatch_bspatch</span><span class="params">(JNIEnv *env, jclass jcls, jstring oldApk_,jstring newApk_, jstring patch_)</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *oldApkPath = (*env)-&gt;GetStringUTFChars(env, oldApk_, <span class="number">0</span>);</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *newApkPath = (*env)-&gt;GetStringUTFChars(env, newApk_, <span class="number">0</span>);</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *patchPath = (*env)-&gt;GetStringUTFChars(env, patch_, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> argc = <span class="number">4</span>;</span><br><span class="line">    <span class="type">char</span>* argv[argc];</span><br><span class="line">    argv[<span class="number">0</span>] = <span class="string">&quot;native-lib&quot;</span>;  <span class="comment">//æ³¨æ„æ­¤å¤„æ˜¯ so åº“åå­—</span></span><br><span class="line">    argv[<span class="number">1</span>] = oldApkPath;</span><br><span class="line">    argv[<span class="number">2</span>] = newApkPath;</span><br><span class="line">    argv[<span class="number">3</span>] = patchPath;</span><br><span class="line"></span><br><span class="line">    jint ret = patchMethod(argc, argv);</span><br><span class="line"></span><br><span class="line">    (*env)-&gt;ReleaseStringUTFChars(env, oldApk_, oldApkPath);</span><br><span class="line">    (*env)-&gt;ReleaseStringUTFChars(env, newApk_, newApkPath);</span><br><span class="line">    (*env)-&gt;ReleaseStringUTFChars(env, patch_, patchPath);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//â€¦â€¦</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä»–ä»£ç é€»è¾‘ï¼š</p>
<ul>
<li>1ï¼‰ä»æœåŠ¡å™¨ä¸‹è½½å·®åˆ†åŒ… update.patch ä¿å­˜åˆ°æœ¬åœ°ï¼Œå¹¶è¯·æ±‚è·å–æ–°ç‰ˆ apk çš„ md5å€¼ï¼›</li>
<li>2ï¼‰æå–æœ¬åœ°çš„ apk æ–‡ä»¶ï¼›</li>
<li>3ï¼‰ä½¿ç”¨ JNI æ–¹æ³•<code>public static native int bspatch(String oldApk, String newApk, String patch)</code>å°† update.patch å’Œæœ¬åœ°æ—§çš„ apk åˆå¹¶æˆæ–°çš„ apkï¼›</li>
<li>4ï¼‰æ ¡éªŒç”Ÿæˆçš„æ–° apk çš„ md å€¼æ˜¯å¦å’ŒæœåŠ¡å™¨è¿”å›çš„ä¸€æ ·ï¼›</li>
<li>5ï¼‰æ£€æµ‹æ–° apk å’ŒæœåŠ¡å™¨æä¾›çš„ä¸€è‡´åï¼Œå®‰è£…æ–°çš„ apk æ–‡ä»¶</li>
</ul>
<p>ä¸è¿‡ demo æ˜¯æ²¡æœ‰å†™ä»æœåŠ¡å™¨ä¸‹è½½å·®åˆ†åŒ…çš„é€»è¾‘çš„ï¼Œè¿™é‡Œæ˜¯å°†å·®åˆ†åŒ…é€šè¿‡ <code>adb push patchè·¯å¾„ /sdcard/NdkSample</code> å‘½ä»¤æ”¾åˆ°æ‰‹æœºæ¥æµ‹è¯•çš„</p>
<p>å…·ä½“ä»£ç å¯ä»¥æŸ¥çœ‹ Githubï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/navyifanr/NdkSample/blob/master/app/src/main/java/cn/cfanr/ndksample/PatchUpdateActivity.java" >NdkSample&#x2F;PatchUpdateActivity.java <i class="fas fa-external-link-alt"></i></a></p>
<h3 id="3-Android-å°è£…-libjpeg-åº“"><a href="#3-Android-å°è£…-libjpeg-åº“" class="headerlink" title="3.  Android å°è£… libjpeg åº“"></a>3.  Android å°è£… libjpeg åº“</h3><h4 id="3-1-ç¼–è¯‘-libjpeg-so-åº“"><a href="#3-1-ç¼–è¯‘-libjpeg-so-åº“" class="headerlink" title="3.1  ç¼–è¯‘ libjpeg.so åº“"></a>3.1  ç¼–è¯‘ libjpeg.so åº“</h4><ul>
<li><p>1.å…‹éš† libjpeg-trubo Android ç‰ˆåˆ°æœ¬åœ°ï¼Œå¹¶è§£å‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git://git.linaro.org/people/tomgall/libjpeg-turbo/libjpeg-turbo.git -b linaro-android</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.åœ¨é…ç½®å¥½ ndk-build ç¯å¢ƒåï¼ˆå…·ä½“æ­¥éª¤ç•¥ï¼‰ï¼Œå¼€å§‹ç¼–è¯‘ libjpeg-trubo åº“<br>æŒ‰ç…§ç½‘ä¸Šå¤§å¤šæ•°æ•™ç¨‹çš„æ­¥éª¤éƒ½æ˜¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ndk-build APP_ABI=armeabi-v7a,armeabi </span><br></pre></td></tr></table></figure></li>
</ul>
<p>ä½†å¯èƒ½ç”±äºæˆ‘æœ¬åœ°é…ç½®çš„ç‰ˆæœ¬æ˜¯ ndk-14çš„ï¼Œç›´æ¥æ‰§è¡Œè¿™ä¸ªå‘½ä»¤å¹¶æ²¡æœ‰å¥æ•ˆï¼Œä»¥ä¸‹æ˜¯æˆ‘é‡åˆ°çš„ä¸€äº›é”™è¯¯ï¼š</p>
<ol>
<li><p>å¦‚æœä½ æ²¡è¿›å…¥ libjpeg-turbo ç›®å½•å°±æ‰§è¡Œå‘½ä»¤ï¼Œå¯èƒ½ä¼šæŠ¥ä»¥ä¸‹é”™è¯¯ï¼Œä¹Ÿå°±æ˜¯æ‰¾ä¸åˆ° Android.mk </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Android NDK: Your APP_BUILD_SCRIPT points to an unknown file: ./Android.mk</span><br><span class="line">/Users/cfanr/Library/Android/sdk/ndk-bundle/build/core/add-application.mk:198: *** Android NDK: Aborting...    .  Stop.</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœæŠ¥æ‰¾ä¸åˆ°åº”ç”¨é¡¹ç›®çš„ç›®å½•ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Android NDK: Could not find application project directory !</span><br><span class="line">Android NDK: Please define the NDK_PROJECT_PATH variable to point to it.</span><br><span class="line">/Users/cfanr/Library/Android/sdk/ndk-bundle/build/core/build-local.mk:151: *** Android NDK: Aborting    .  Stop.</span><br></pre></td></tr></table></figure></li>
</ol>
<p>å°±éœ€è¦è®¾ç½®ä¸‹ <code>NDK_PROJECT_PATH</code> æŒ‡å®šéœ€è¦ç¼–è¯‘çš„ä»£ç çš„å·¥ç¨‹ç›®å½•ï¼Œè¿™é‡Œç»™å‡ºçš„æ˜¯å½“å‰ç›®å½•ï¼Œè¿˜æœ‰ï¼Œ<code>APP_BUILD_SCRIPT</code>æ˜¯Android makefileæ–‡ä»¶çš„è·¯å¾„ï¼Œå¦‚æœä½ è¿˜æœ‰ <code>Application.mk</code> æ–‡ä»¶çš„è¯ï¼Œåˆ™å¯ä»¥æ·»åŠ  <code>NDK_APP_APPLICATION_MK=./Application.mk </code>ï¼Œå‚è€ƒï¼š<a class="link"   target="_blank" rel="noopener" href="http://ticktick.blog.51cto.com/823160/1428354" >Androidå¼€å‘å®è·µï¼šåœ¨ä»»æ„ç›®å½•æ‰§è¡ŒNDKç¼–è¯‘ - Jhusterçš„ä¸“æ <i class="fas fa-external-link-alt"></i></a></p>
<ol start="3">
<li>å¦‚æœ NDK ç‰ˆæœ¬è¿‡é«˜ï¼Œå¯èƒ½ä¼šæŠ¥ä»¥ä¸‹é”™è¯¯ï¼Œ<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Android.mk:11: Extraneous text after `ifeq&#x27; directive</span><br><span class="line">Android NDK: WARNING: Unsupported source file extensions in Android.mk for module jpeg</span><br><span class="line">Android NDK:   turbojpeg-mapfile</span><br><span class="line">/Users/cfanr/Library/Android/sdk/ndk-bundle/build/core/build-binary.mk:687: Android NDK: Module jpeg depends on undefined modules: cutils</span><br><span class="line">/Users/cfanr/Library/Android/sdk/ndk-bundle/build/core/build-binary.mk:700: *** Android NDK: Aborting (set APP_ALLOW_MISSING_DEPS=true to allow missing dependencies)    .  Stop.</span><br></pre></td></tr></table></figure></li>
</ol>
<p>æ‰€ä»¥ï¼Œæˆ‘æœ€ç»ˆçš„è§£å†³æ–¹æ³•æ˜¯ç”¨æŒ‡å®šçš„ä½ç‰ˆæœ¬çš„ ndk ï¼ˆndk-r11cï¼‰å»ç¼–è¯‘ï¼Œè€Œä¸æ˜¯ç”¨æˆ‘åœ¨ç³»ç»Ÿé…ç½® ndkã€‚æ­£ç¡®çš„å‘½ä»¤ï¼Œä½¿ç”¨æŒ‡å®šNDKç‰ˆæœ¬ç¼–è¯‘<br><code>~/NDK/android-ndk-r11c/ndk-build NDK_PROJECT_PATH=. APP_BUILD_SCRIPT=./Android.mk APP_ABI=armeabi-v7a,armeabi</code></p>
<p><strong>æ£€æµ‹å·²ç¼–è¯‘æˆåŠŸï¼šç¼–è¯‘æˆåŠŸåï¼Œä¼šåœ¨ libjpeg-turbo ç”Ÿæˆ libs å’Œ obj æ–‡ä»¶å¤¹ï¼Œé‡Œé¢åˆ†åˆ«ä¼šæœ‰ä½ è®¾ç½®çš„ ABI ç±»å‹çš„  libjpeg.so åº“å’Œå…¶ä»–ç”Ÿæˆçš„æ–‡ä»¶ï¼Œéœ€è¦æ‹·è´åˆ°é¡¹ç›®ä¸­çš„æ˜¯ libs æ–‡ä»¶ä¸‹çš„ libjpeg.so åº“ã€‚</strong></p>
<h4 id="3-2-ä½¿ç”¨-libjpeg-so-åº“ç¼–å†™å‹ç¼©å›¾ç‰‡çš„-native-æ–¹æ³•"><a href="#3-2-ä½¿ç”¨-libjpeg-so-åº“ç¼–å†™å‹ç¼©å›¾ç‰‡çš„-native-æ–¹æ³•" class="headerlink" title="3.2 ä½¿ç”¨ libjpeg.so åº“ç¼–å†™å‹ç¼©å›¾ç‰‡çš„ native æ–¹æ³•"></a>3.2 ä½¿ç”¨ libjpeg.so åº“ç¼–å†™å‹ç¼©å›¾ç‰‡çš„ native æ–¹æ³•</h4><p>å‚è€ƒï¼š<a class="link"   target="_blank" rel="noopener" href="http://blog.csdn.net/a992036795/article/details/53814178" >Androidä½¿ç”¨libjpegå®ç°å›¾ç‰‡å‹ç¼© - BlueBerryçš„ä¸“æ  - CSDNåšå®¢<i class="fas fa-external-link-alt"></i></a></p>
<ul>
<li><p><strong>1.æ‹·è´ libjpeg.so å’Œå¤´æ–‡ä»¶åˆ°é¡¹ç›®ä¸­</strong><br>é¦–å…ˆå°†ä¸åŒ ABI çš„ libjpeg.so æ‹·è´åˆ°é¡¹ç›®çš„ libs ç›®å½•ä¸‹ï¼Œå†å°†ä¸Šé¢ä¸‹è½½çš„ libjpeg-turbo çš„æºç çš„æ‰€æœ‰å¤´æ–‡ä»¶æ‹·è´åˆ° cpp&#x2F;include ç›®å½•ä¸‹</p>
</li>
<li><p><strong>2.é…ç½®CMakeListsæ–‡ä»¶</strong><br>ç»ƒä¹ æ—¶ï¼Œè¦æ³¨æ„ CMakeLists çš„é…ç½®ï¼Œä¸ç„¶å¯èƒ½ä¼šå‘ç”Ÿä»¥ä¸‹é”™è¯¯ï¼ˆåšä¸»å°±æ˜¯å› ä¸ºæ²¡çœ‹æ¸…æ¥šæ–‡ç« ï¼Œæ²¡é…ç½®å¥½ï¼Œå‡ºé”™åï¼Œä¸€ç›´æœç´¢ï¼Œæµªè´¹ä¸å°‘æ—¶é—´ ğŸ¤·â€â™€ï¸ï¼‰</p>
</li>
</ul>
<p>1ï¼‰å¦‚æœ CMakeLists.txt æ–‡ä»¶å…³è”åˆ°Androidçš„ Bitmap ç›¸å…³åº“<code>jnigraphics</code>ï¼Œä¼šæŠ¥ä»¥ä¸‹é”™è¯¯ï¼Œæœªå®šä¹‰ Bitmap</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Error:(39) undefined reference to &#x27;AndroidBitmap_getInfo&#x27;</span><br><span class="line">Error:(43) undefined reference to &#x27;AndroidBitmap_lockPixels&#x27;</span><br><span class="line">Error:(85) undefined reference to &#x27;AndroidBitmap_unlockPixels&#x27;</span><br><span class="line">Error:error: linker command failed with exit code 1 (use -v to see invocation)</span><br></pre></td></tr></table></figure>

<p>2ï¼‰å¦‚æœåªæ˜¯æ·»åŠ äº† libjpeg.so åº“<code>add_library(libjpeg SHARED IMPORTED )</code>ï¼Œæœªè®¾ç½®å…³è”åº“<code>target_link_libraries()</code>ï¼Œä¼šæŠ¥ç±»ä¼¼ä»¥ä¸‹æœªå®šä¹‰æŸäº›å±æ€§çš„é”™è¯¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Error:(99) undefined reference to &#x27;jpeg_std_error&#x27;</span><br><span class="line">Error:(106) undefined reference to &#x27;jpeg_CreateCompress&#x27;</span><br><span class="line">Error:(114) undefined reference to &#x27;jpeg_stdio_dest&#x27;</span><br><span class="line">Error:(122) undefined reference to &#x27;jpeg_set_defaults&#x27;</span><br><span class="line">Error:(126) undefined reference to &#x27;jpeg_set_quality&#x27;</span><br></pre></td></tr></table></figure>

<p>çœ‹æ¥ä¸ç†Ÿæ‚‰ç†è§£ CMake æ„å»ºè„šæœ¬è¿˜æ˜¯æŒºå®¹æ˜“è¸©å‘çš„ï¼Œä¸‹ç¯‡ä¼šè¯¦ç»†ä»‹ç» CMake æ„å»ºè„šæœ¬çš„ä½¿ç”¨ã€‚<br>å®Œæ•´æ„å»ºè„šæœ¬å¦‚ä¸‹ï¼šï¼ˆå¦‚æœ libjpeg.so æˆ–å¤´æ–‡ä»¶æ”¾ç½®çš„ç›®å½•å’Œæˆ‘çš„ä¸ä¸€æ ·ï¼Œä¸‹é¢å°±éœ€è¦ä¿®æ”¹ä¸‹ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># Sets the minimum version of CMake required to build the native library.</span><br><span class="line">cmake_minimum_required(VERSION 3.4.1)</span><br><span class="line"></span><br><span class="line">#è®¾ç½®ç”Ÿæˆçš„soåŠ¨æ€åº“æœ€åè¾“å‡ºçš„è·¯å¾„</span><br><span class="line">set(CMAKE_LIBRARY_OUTPUT_DIRECTORY $&#123;PROJECT_SOURCE_DIR&#125;/src/main/jniLibs/$&#123;ANDROID_ABI&#125;)</span><br><span class="line"></span><br><span class="line">#æŒ‡å®šè¦å¼•ç”¨çš„libjpeg.soçš„å¤´æ–‡ä»¶ç›®å½•</span><br><span class="line">set(LIBJPEG_INCLUDE_DIR src/main/cpp/include)</span><br><span class="line">include_directories($&#123;LIBJPEG_INCLUDE_DIR&#125;)</span><br><span class="line"></span><br><span class="line">#å¯¼å…¥libjpegåŠ¨æ€åº“ SHAREDï¼›é™æ€åº“ä¸ºSTATIC</span><br><span class="line">add_library(libjpeg SHARED IMPORTED)</span><br><span class="line">#å¯¹åº”soç›®å½•ï¼Œè¿™é‡Œä¸ºäº†ç®€å•è®¾ç½®çš„æ˜¯ç»å¯¹è·¯å¾„ï¼ˆæ³¨æ„è¦å…ˆ add_libraryï¼Œå† set_target_propertiesï¼‰</span><br><span class="line">set_target_properties(libjpeg PROPERTIES IMPORTED_LOCATION /Users/cfanr/AndroidStudioProjects/DemoProjects/NDKSample/compress/libs/$&#123;ANDROID_ABI&#125;/libjpeg.so)</span><br><span class="line"></span><br><span class="line">add_library(</span><br><span class="line">             compress</span><br><span class="line">             SHARED</span><br><span class="line">             src/main/cpp/compress.c</span><br><span class="line">             )</span><br><span class="line"></span><br><span class="line">find_library(graphics jnigraphics)</span><br><span class="line">find_library(log-lib log)</span><br><span class="line"></span><br><span class="line">target_link_libraries(compress libjpeg $&#123;log-lib&#125; $&#123;graphics&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>3.ç¼–å†™Java å±‚ native æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImageCompress</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;compress&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">ImageCompress</span><span class="params">()</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">compressBitmap</span><span class="params">(Bitmap bitmap, String dstPath, <span class="type">int</span> quality, <span class="type">boolean</span> isOptimize)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>4.å®ç° JNI é€»è¾‘</p>
<ul>
<li>1ï¼‰å°† Android çš„ Bitmap è§£ç è½¬åŒ–ä¸º RGB æ•°æ®ï¼›</li>
<li>2ï¼‰ä¸º JPEG å¯¹è±¡åˆ†é…ç©ºé—´å¹¶åˆå§‹åŒ–ï¼›</li>
<li>3ï¼‰è·å–æ–‡ä»¶ä¿¡æ¯ï¼Œç„¶åæŒ‡å®šå‹ç¼©æ•°æ®æºï¼›</li>
<li>4ï¼‰ä¸ºå‹ç¼©è®¾å®šå‚æ•°ï¼ŒåŒ…æ‹¬å›¾åƒå¤§å°ï¼Œé¢œè‰²ç©ºé—´ï¼›</li>
<li>5ï¼‰å¼€å§‹å‹ç¼©ï¼›</li>
<li>6ï¼‰å‹ç¼©å®Œæ¯•åï¼Œé‡Šæ”¾èµ„æºï¼›</li>
</ul>
</li>
</ul>
<p>å…·ä½“ä»£ç æŸ¥çœ‹ï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/navyifanr/NdkSample/blob/master/compress/src/main/cpp/compress.c" > navyifanr&#x2F;NdkSample: compress.c<i class="fas fa-external-link-alt"></i></a></p>
<p>æ•ˆæœå›¾ï¼š<br><img src="https://i.loli.net/2019/06/10/5cfe73467f24a29392.png" alt="æ•ˆæœå›¾"></p>
<h3 id="4-NDKæŠ€æœ¯åœ¨-Android-çš„åº”ç”¨åœºæ™¯ç®€è¿°"><a href="#4-NDKæŠ€æœ¯åœ¨-Android-çš„åº”ç”¨åœºæ™¯ç®€è¿°" class="headerlink" title="4. NDKæŠ€æœ¯åœ¨ Android çš„åº”ç”¨åœºæ™¯ç®€è¿°"></a>4. NDKæŠ€æœ¯åœ¨ Android çš„åº”ç”¨åœºæ™¯ç®€è¿°</h3><h4 id="4-1-é¦–å…ˆéœ€è¦äº†è§£-NDk-æœ‰ä»€ä¹ˆä½œç”¨å’Œç‰¹ç‚¹ï¼Ÿ"><a href="#4-1-é¦–å…ˆéœ€è¦äº†è§£-NDk-æœ‰ä»€ä¹ˆä½œç”¨å’Œç‰¹ç‚¹ï¼Ÿ" class="headerlink" title="4.1 é¦–å…ˆéœ€è¦äº†è§£ NDk æœ‰ä»€ä¹ˆä½œç”¨å’Œç‰¹ç‚¹ï¼Ÿ"></a>4.1 é¦–å…ˆéœ€è¦äº†è§£ NDk æœ‰ä»€ä¹ˆä½œç”¨å’Œç‰¹ç‚¹ï¼Ÿ</h4><p>NDK ä½œç”¨æ˜¯ Google æä¾›äº†äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼Œèƒ½å¤Ÿåœ¨ linux å¹³å°ç¼–è¯‘å‡ºåœ¨ arm å¹³å°ä¸‹æ‰§è¡Œçš„äºŒè¿›åˆ¶åº“æ–‡ä»¶ï¼›<br>NDK ç‰¹ç‚¹ï¼šï¼ˆæ¥è‡ªï¼š<a class="link"   target="_blank" rel="noopener" href="http://blog.csdn.net/carson_ho/article/details/73250163" >Androidï¼šJNI ä¸ NDKåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ- Carson_Hoçš„åšå®¢ - CSDNåšå®¢<i class="fas fa-external-link-alt"></i></a>ï¼‰<br><img src="https://i.loli.net/2019/06/10/5cfe734475cce52169.png" alt="NDKç‰¹ç‚¹"></p>
<h4 id="4-2-åº”ç”¨åœºæ™¯"><a href="#4-2-åº”ç”¨åœºæ™¯" class="headerlink" title="4.2 åº”ç”¨åœºæ™¯"></a>4.2 åº”ç”¨åœºæ™¯</h4><ul>
<li>ä¼˜åŒ–å¯†é›†è¿ç®—å’Œæ¶ˆè€—èµ„æºè¾ƒå¤§æ¨¡å—çš„æ€§èƒ½ï¼Œå¦‚éŸ³è§†é¢‘è§£ç ï¼Œå›¾åƒæ“ä½œç­‰</li>
<li>éœ€è¦æé«˜å®‰å…¨æ€§çš„åœ°æ–¹ï¼Œç¼–è¯‘æˆ so  åº“ä¸å®¹æ˜“è¢«åç¼–è¯‘ï¼›å¦‚æ–‡ä»¶åŠ å¯†ã€æ ¸å¿ƒç®—æ³•æ¨¡å—ç­‰ï¼›</li>
<li>è·¨å¹³å°åº”ç”¨çš„éœ€è¦ï¼›</li>
</ul>
<p>ä¸€äº› Android NDK çš„å…·ä½“åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>è·¨å¹³å°çš„éŸ³è§†é¢‘è§£ç åº“ FFmpegï¼›</li>
<li>Android å¢é‡æ›´æ–°æŠ€æœ¯ï¼›</li>
<li>Android åŠ å›ºå’Œé˜²é€†å‘æŠ€æœ¯ï¼›</li>
<li>ä¸€äº›çƒ­ä¿®å¤æŠ€æœ¯ï¼›</li>
<li>äººè„¸è¯†åˆ«ï¼ŒOpenCV ç­‰</li>
<li>Android å¹³å°çš„æ¸¸æˆå¼€å‘ç­‰ï¼›</li>
</ul>
<p>é™„ï¼š<br>C&#x2F;C++ä»£ç è¢«ç¼–è¯‘æˆåº“æ–‡ä»¶ä¹‹åï¼Œæ‰èƒ½æ‰§è¡Œï¼Œåº“æ–‡ä»¶åˆ†ä¸ºåŠ¨æ€åº“å’Œé™æ€åº“ä¸¤ç§ï¼š<br><img src="https://i.loli.net/2019/06/10/5cfe73449feef56205.png" alt="SO åº“ç±»å‹"></p>
<p>åº“æ–‡ä»¶æ¥æºï¼šC&#x2F;C++ä»£ç è¿›è¡Œç¼–è¯‘é“¾æ¥æ“ä½œä¹‹åï¼Œæ‰ä¼šç”Ÿæˆåº“æ–‡ä»¶ï¼Œä¸åŒç±»å‹çš„CPU æ“ä½œç³»ç»Ÿç”Ÿæˆçš„åº“æ–‡ä»¶æ˜¯ä¸ä¸€æ ·ï¼›</p>
<ul>
<li>CPUåˆ†ç±»ï¼šarmç»“æ„ï¼ŒåµŒå…¥å¼è®¾å¤‡å¤„ç†å™¨ï¼› x86ç»“æ„ï¼Œpc æœåŠ¡å™¨å¤„ç†å™¨ï¼› ä¸åŒçš„CPUæŒ‡ä»¤é›†ä¸åŒï¼›</li>
<li>äº¤å‰ç¼–è¯‘ï¼šwindows x86ç¼–è¯‘å‡ºæ¥çš„åº“æ–‡ä»¶å¯ä»¥åœ¨armå¹³å°è¿è¡Œçš„ä»£ç ï¼›</li>
<li>äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼šGoogleæä¾›çš„ NDK å°±æ˜¯äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼Œå¯ä»¥åœ¨linuxç¯å¢ƒä¸‹ç¼–è¯‘å‡ºåœ¨ARM å¹³å°ä¸‹æ‰§è¡Œçš„äºŒè¿›åˆ¶åº“æ–‡ä»¶ï¼›</li>
</ul>
<p><strong>è¡¥å……ï¼šæ·»åŠ  .so åº“é“¾æ¥çš„æ–¹æ³•</strong></p>
<ol>
<li>ç®€å•ç²—æš´çš„æ–¹æ³•<br>ç›´æ¥åœ¨ project æˆ– module åˆ›å»ºä¸€ä¸ª src&#x2F;main&#x2F;jniLibs æ–‡ä»¶å¤¹ï¼Œç„¶åæ‹·è´ .so æ–‡ä»¶åˆ°è¯¥æ–‡ä»¶å¤¹ä¸‹(å½“ç„¶ so åº“è¦æŒ‡å®š ABI ç±»å‹)ï¼Œå¦‚ <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-----src</span><br><span class="line">--------main</span><br><span class="line">------------jniLibs</span><br><span class="line">-----------------armabi</span><br><span class="line">---------------------libcompress.so</span><br></pre></td></tr></table></figure></li>
<li>æ·»åŠ åˆ° libs çš„æ–¹æ³•<br>ç›´æ¥æ‹·è´å« abi ç±»å‹çš„ so åº“åˆ° project-root&#x2F;libs æˆ– module-root&#x2F;libs ä¸‹ï¼Œå¦‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-----app</span><br><span class="line">--------libs</span><br><span class="line">------------armabi</span><br><span class="line">------------------libcompress.so</span><br></pre></td></tr></table></figure>
ç„¶ååœ¨è¯¥ project æˆ– module çš„ build.gradle æ–‡ä»¶ä¸‹æ·»åŠ  jnilibs çš„ç›®å½•è·¯å¾„ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">	//â€¦â€¦</span><br><span class="line">	sourceSets &#123;</span><br><span class="line">		main &#123;</span><br><span class="line">			jniLibs.srcDirs = [&#x27;libs&#x27;]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
æœ€å build ä»¥ä¸‹å³å¯ï¼Œå…¶å®æœ€ç»ˆè¿˜æ˜¯å’Œç¬¬ä¸€ç§æ–¹æ³•ä¸€è‡´çš„ï¼Œåˆ‡æ¢é¡¹ç›®çš„é¢„è§ˆæ¨¡å¼ä¸ºâ€˜androidâ€™ï¼Œå¯ä»¥çœ‹åˆ°å¤šäº†ä¸€ä¸ª jniLibs çš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æ”¾çš„å†…å®¹å’Œ libs çš„ä¸€æ ·ã€‚</li>
</ol>
<p>å‚è€ƒèµ„æ–™ï¼š<br><a class="link"   target="_blank" rel="noopener" href="http://www.jianshu.com/p/4333d7ddf615" >NDKå¼€å‘åŸºç¡€â‘¡æ–‡ä»¶åŠ å¯†è§£å¯†ä¸åˆ†å‰²åˆå¹¶ - ç®€ä¹¦<i class="fas fa-external-link-alt"></i></a><br><a class="link"   target="_blank" rel="noopener" href="http://blog.csdn.net/lmj623565791/article/details/52761658" >Android å¢é‡æ›´æ–°å®Œå…¨è§£æ  æ˜¯å¢é‡ä¸æ˜¯çƒ­ä¿®å¤ - Hongyang - CSDNåšå®¢<i class="fas fa-external-link-alt"></i></a><br><a class="link"   target="_blank" rel="noopener" href="http://blog.csdn.net/myatlantis/article/details/52874227#t1" >Androidå¢é‡æ›´æ–°ä¸CMakeæ„å»ºå·¥å…· - äºšç‰¹å…°è’‚æ–¯ - CSDNåšå®¢<i class="fas fa-external-link-alt"></i></a><br><a class="link"   target="_blank" rel="noopener" href="http://blog.csdn.net/honjane/article/details/60328361" >JNIå¼€å‘å®ä¾‹-å°è£…libjpegåº“ ä¿è¯å›¾ç‰‡è´¨é‡å‹ç¼©å›¾ç‰‡ - çŒ«çš„é˜æ¥¼ - CSDNåšå®¢<i class="fas fa-external-link-alt"></i></a><br><a class="link"   target="_blank" rel="noopener" href="http://blog.csdn.net/a992036795/article/details/53814178" >Androidä½¿ç”¨libjpegå®ç°å›¾ç‰‡å‹ç¼© - BlueBerryçš„ä¸“æ  - CSDNåšå®¢<i class="fas fa-external-link-alt"></i></a><br><a class="link"   target="_blank" rel="noopener" href="http://blog.csdn.net/carson_ho/article/details/73250163" >Androidï¼šJNI ä¸ NDKåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ- Carson_Hoçš„åšå®¢ - CSDNåšå®¢<i class="fas fa-external-link-alt"></i></a></p>

        </div>

        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/Android-NDK/">#Android NDK</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2017/08/26/Android-NDK-dev-CMake-s-usage/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Android NDK å¼€å‘ï¼šCMake ä½¿ç”¨</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2017/08/05/Android-NDK-dev-JNI-s-practice/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Android NDKå¼€å‘ï¼šJNIå®æˆ˜ç¯‡</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2023&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">cfanr</a>
        </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>








<div class="post-scripts">
    
</div>



</body>
</html>
